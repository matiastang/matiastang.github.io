import{_ as d,c as l,a as h,b as e,e as a,f as t,r as o,o as c,d as n}from"./app-CS9K37Kg.js";const p={};function r(k,s){const i=o("RouteLink");return c(),l("div",null,[s[2]||(s[2]=h(`<h2 id="介绍" tabindex="-1"><a class="header-anchor" href="#介绍"><span>介绍</span></a></h2><p><code>ssh</code> 推荐的登录方式是使用私钥登录。但是如果生成私钥的时候，设置了口令/密码（<code>passphrase</code>），每次登录时需要输入口令也很麻烦。可以通过 <code>ssh-agent</code> 来管理私钥，把私钥加载进内存，之后便不用再输入密码。</p><p>当我们的主机有多个密钥对（例如：<code>root</code>用户生成了一对公钥私钥对，<code>mt</code>用户生成了另外一对公钥私钥对），我们连接到其他不同的多台主机时，可能用的认证用户不一样，这时候需要我们手动指定使用哪个密钥，一旦机器过多输入会非常繁琐，<code>ssh-agent</code>能帮我们管理这些密钥对。当我们给私钥加了密码，而我们的认证方式又选择了密钥认证，<code>ssh-agent</code>可以帮助我们免去输入密码的繁琐操作。</p><h2 id="ssh-agent-使用" tabindex="-1"><a class="header-anchor" href="#ssh-agent-使用"><span><code>ssh-agent</code> 使用</span></a></h2><ol><li>启动 <code>ssh-agent</code></li></ol><p>通过 <code>ssh-agent bash</code> 或者 <code>eval ssh-agent</code> （这里是<code>shell</code> 的命令替换符）来启动。</p><ol start="2"><li>添加私钥到 <code>ssh-agent</code></li></ol><p>通过 <code>ssh-add Identity_Linux</code> 为 <code>ssh-agent</code> 添加私钥。这里的 <code>Identity_Linux</code> 是我的私钥文件。</p><ol start="3"><li>查看 <code>ssh-agent</code> 中的私钥</li></ol><p>添加之后，可通过 <code>ssh-add -l</code> 来查看已经添加的私钥。</p><ol start="4"><li>测试</li></ol><p>在没有将私钥添加到<code>ssh-agent</code>之前，我们也可以通过如下命令来登录远程主机：</p><div class="language-sh line-numbers-mode" data-ext="sh" data-title="sh"><button class="copy" title="复制代码" data-copied="已复制"></button><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code><span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">$</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> ssh</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> root@192.168.1.1</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>但如果私钥不是放在 <code>ssh</code> 客户端缺省读取的位置或者不是默认的名字，就需要使用 <code>-i</code> 选项显示的指定私钥文件。</p><div class="language-sh line-numbers-mode" data-ext="sh" data-title="sh"><button class="copy" title="复制代码" data-copied="已复制"></button><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code><span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">$</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> ssh</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> -i</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> Identity_Linux</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> root@192.168.1.1</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>还有就是如果<code>私钥</code>设置了密码，就需要输入<code>私钥</code>的密码。</p><p>在给代理添加私钥时，需要输入一次私钥的口令。之后不再指定私钥也不需口令即可登录了。</p><div class="language-sh line-numbers-mode" data-ext="sh" data-title="sh"><button class="copy" title="复制代码" data-copied="已复制"></button><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code><span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">$</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> ssh</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> root@192.168.1.1</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h2 id="ssh-agent-原理" tabindex="-1"><a class="header-anchor" href="#ssh-agent-原理"><span><code>ssh-agent</code> 原理</span></a></h2><p>用户使用 <code>ssh-agent</code> 来管理私钥之后。<code>ssh-agent</code> 会启动一个进程在内存里保存这些私钥。之后每次登录时，<code>ssh</code> 客户端都会跟 <code>ssh-agent</code> 请求是否有目标主机的私钥，如果有 <code>ssh</code> 客户端便能直接登录目标主机。</p><p><code>ssh-add</code> 这个命令不是用来永久性的记住你所使用的私钥的。实际上，它的作用只是把你指定的私钥添加到 <code>ssh-agent</code> 所管理的一个 <code>session</code> 当中。而 <code>ssh-agent</code> 是一个用于存储私钥的临时性的 <code>session</code> 服务，也就是说当你重启之后，<code>ssh-agent</code> 服务也就重置了。</p><p>如果是为了永久记住对应的私钥是哪个，我们不能依赖 <code>ssh-agent</code> 服务。</p><p><strong>注意</strong> 如果私钥设置了密码，应该保存好私钥的密码。</p><h2 id="自动启动-ssh-代理" tabindex="-1"><a class="header-anchor" href="#自动启动-ssh-代理"><span>自动启动 <code>SSH</code> 代理</span></a></h2><p>可以考虑自动启动 <code>ssh-agent</code> 服务，并自动添加私钥。</p><p>你可以通过修改 <code>.bashrc</code> 或 <code>.zshrc</code> 文件（取决于你使用的 <code>Shell</code>），使 <code>SSH</code> 代理在每次打开终端时自动启动。</p><p>示例（<code>.bashrc</code> 或 <code>.zshrc</code>）：</p><div class="language-sh line-numbers-mode" data-ext="sh" data-title="sh"><button class="copy" title="复制代码" data-copied="已复制"></button><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code><span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;"># 启动 SSH 代理</span></span>
<span class="line"><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">if</span><span style="--shiki-light:#999999;--shiki-dark:#666666;"> [</span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;"> -z</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;"> &quot;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">$SSH_AUTH_SOCK</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#999999;--shiki-dark:#666666;"> ];</span><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;"> then</span></span>
<span class="line"><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">  eval</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;"> &quot;</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">$(</span><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">ssh-agent</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> -s</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">)</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">  ssh-add</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> ~/.ssh/id_ed25519</span></span>
<span class="line"><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">fi</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>提示</strong> 注意就是让 <code>SSH</code> 代理自动启动，这里是每次打开终端时都会启动。也可以写成一个脚本文件，配置脚本文件在启动时自动执行，反正只要能执行 <code>SSH</code> 代理启动命令并添加私钥即可，方法挺多。</p><p><strong>注意</strong> 前面所有的命令均在<code>Windows PowerShell</code>中执行的。</p><h2 id="参考" tabindex="-1"><a class="header-anchor" href="#参考"><span>参考</span></a></h2>`,31)),e("p",null,[a(i,{to:"/linux/9lp2seml.html"},{default:t(()=>s[0]||(s[0]=[n("ssh-add")])),_:1})]),e("p",null,[a(i,{to:"/article/h609uylx.html"},{default:t(()=>s[1]||(s[1]=[n("Windows通过密钥访问github")])),_:1})]),s[3]||(s[3]=e("p",null,[e("a",{href:"https://blog.csdn.net/weixin_43972437/article/details/114578337",target:"_blank",rel:"noopener noreferrer"},"ssh-agent、ssh-add")],-1))])}const u=d(p,[["render",r],["__file","8u96z9c4.html.vue"]]),m=JSON.parse('{"path":"/linux/8u96z9c4.html","title":"ssh-agent","lang":"zh-CN","frontmatter":{"title":"ssh-agent","createTime":"2025/01/14 13:59:49","permalink":"/linux/8u96z9c4.html","watermark":true},"headers":[],"readingTime":{"minutes":3.12,"words":937},"git":{"updatedTime":1755670488000,"contributors":[{"name":"唐道勇","username":"唐道勇","email":"matias@tangdaoyongdeMacBook-Pro.local","commits":1,"avatar":"https://avatars.githubusercontent.com/唐道勇?v=4","url":"https://github.com/唐道勇"}]},"filePathRelative":"notes/linux/ssh-agent.md","bulletin":false}');export{u as comp,m as data};
