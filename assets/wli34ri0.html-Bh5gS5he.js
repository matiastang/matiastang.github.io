import{_ as l,c as h,a as d,b as i,d as e,e as t,f as n,r as o,o as r}from"./app-CS9K37Kg.js";const p={};function c(k,s){const a=o("RouteLink");return r(),h("div",null,[s[7]||(s[7]=d('<h2 id="介绍" tabindex="-1"><a class="header-anchor" href="#介绍"><span>介绍</span></a></h2><p>我们经常需要使用<code>ssh</code>命令来连接远程服务器等，每次都需要输入密码，比较麻烦，可以通过配置<code>SSH</code>实现免密登录。</p><h2 id="使用" tabindex="-1"><a class="header-anchor" href="#使用"><span>使用</span></a></h2><p>在远程主机的操作，主要是添加公钥。 在本地主要是修改<code>SSH</code>配置文件。</p><p>主要流程如下：</p><ol><li>在本地生成公钥和私钥</li><li>将公钥添加到远程主机</li><li>修改本地<code>SSH</code>配置文件，实现免密登录</li><li>测试免密登录</li></ol><h3 id="生成rsa秘钥" tabindex="-1"><a class="header-anchor" href="#生成rsa秘钥"><span>生成<code>RSA</code>秘钥</span></a></h3>',7)),i("p",null,[s[1]||(s[1]=e("可以参考")),t(a,{to:"/article/x9ugwl1u.html"},{default:n(()=>s[0]||(s[0]=[i("code",null,"windows生成RAS密钥",-1)])),_:1}),s[2]||(s[2]=e("，和")),s[3]||(s[3]=i("code",null,"Linux",-1)),s[4]||(s[4]=e("中的差不多。"))]),s[8]||(s[8]=d(`<h3 id="添加公钥到远程主机" tabindex="-1"><a class="header-anchor" href="#添加公钥到远程主机"><span>添加公钥到远程主机</span></a></h3><ul><li>添加公钥到云服务器</li></ul><p>将生成的公钥内容添加到服务器的 <code>~/.ssh/authorized_keys</code> 文件中。</p><p><strong>注意</strong> 需要注意 <code>authorized_keys</code> 文件的权限，必须是 <code>600</code>。可以通过<code>chmod</code>命令修改权限。</p><ul><li>添加公钥到<code>Github</code></li></ul><p>登录<code>Github</code>后，进入<code>Settings</code>-&gt;<code>SSH and GPG keys</code>-&gt;<code>New SSH key</code>粘贴上公钥，然后取个便于区别密钥来源的名称就行了。</p><h3 id="修改本地ssh配置文件" tabindex="-1"><a class="header-anchor" href="#修改本地ssh配置文件"><span>修改本地<code>SSH</code>配置文件</span></a></h3><p>将公钥添加到 <code>authorized_keys</code> 文件等远程中，私钥在本地，可以通过<code>ssh root@10.1.1.1</code>的方式访问远程，省去了输入密码的步骤，但用户名和 <code>IP</code> 地址也不短，或处于安全的原因，不想让其他人看到。可以通过配置 <code>~/.ssh/config</code> 实现省略用户名和 <code>IP</code> 地址。默认情况下 <code>~/.ssh</code> 目录下是没有 <code>config</code> 文件的。</p><p>我们可以通过命令创建：</p><div class="language-sh line-numbers-mode" data-ext="sh" data-title="sh"><button class="copy" title="复制代码" data-copied="已复制"></button><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code><span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">$</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> vim</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> ~/.ssh/config</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p><code>SSH</code> 客户端配置文件位于 <code>~/.ssh/config</code>，添加内容如下：</p><div class="language-sh line-numbers-mode" data-ext="sh" data-title="sh"><button class="copy" title="复制代码" data-copied="已复制"></button><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code><span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">Host</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> example</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">HostName</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> example.com</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">User</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> root</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">Port</span><span style="--shiki-light:#2F798A;--shiki-dark:#4C9A91;"> 22</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">IdentityFile</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> ~/.ssh/id_rsa</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><code>Host</code> 代表云服务器昵称 <code>HostName</code> 为云服务器的公网 <code>IP</code> 地址，如果配置了域名也可以使用域名，如上就是使用的域名。 <code>Port</code> 代表连接时使用的端口号 <code>User</code> 代表连接时选用的用户名 <code>IdentityFile</code> 代表本地私钥文件的路径。</p><p>这样我们就可以用云服务器<strong>昵称</strong>登录云服务器啦，在终端输入：</p><div class="language-sh line-numbers-mode" data-ext="sh" data-title="sh"><button class="copy" title="复制代码" data-copied="已复制"></button><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code><span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">$</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> ssh</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> example</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h3 id="连接测试" tabindex="-1"><a class="header-anchor" href="#连接测试"><span>连接测试</span></a></h3><p>可以使用如下命令测试<code>Github</code>的连通性</p><div class="language-sh line-numbers-mode" data-ext="sh" data-title="sh"><button class="copy" title="复制代码" data-copied="已复制"></button><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code><span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">$</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> ssh</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> -T</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> git@github.com</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">Hi</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> matiastang!</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> You</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&#39;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">ve successfully authenticated, but GitHub does not provide shell access.</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><p>如上面一步配置好后可以使用如下命令连接：</p><div class="language-sh line-numbers-mode" data-ext="sh" data-title="sh"><button class="copy" title="复制代码" data-copied="已复制"></button><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code><span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">$</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> ssh</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> example</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>如果是第一次登录到这台云服务器，终端会有确认提示：</p><div class="language-sh line-numbers-mode" data-ext="sh" data-title="sh"><button class="copy" title="复制代码" data-copied="已复制"></button><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code><span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">The</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> authenticity</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> of</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> host</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;"> &#39;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">10.1.1.1 (10.1.1.1)</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&#39;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> can</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&#39;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">t be established.</span></span>
<span class="line"><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">ECDSA key fingerprint is SHA256:nGvmS+JKzQf1gG+Nzc0QN/qS6xSp1iV0rJFP1dILel4.</span></span>
<span class="line"><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">Are you sure you want to continue connecting (yes/no/[fingerprint])? yes</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>这时候我们输入 <code>yes</code> 并回车即可。下次再链接就不会提示了，这个是为了防止<strong>中间人攻击</strong>。</p><h3 id="sshd免密登录失败" tabindex="-1"><a class="header-anchor" href="#sshd免密登录失败"><span><code>sshd</code>免密登录失败</span></a></h3><p>有些服务器中的 <code>sshd</code> 服务配置并未开启公钥登录选项，如果<code>ssh root@10.1.1.1</code>命令回车后终端显示的不是云服务器相关信息，而是输入密码的话，就需要我们到云服务器上开启 <code>sshd</code> 服务的公钥登录配置。</p><p>在云服务器上执行：</p><div class="language-sh line-numbers-mode" data-ext="sh" data-title="sh"><button class="copy" title="复制代码" data-copied="已复制"></button><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code><span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">$</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> vim</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> /etc/ssh/sshd_config</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>进入到 <code>sshd</code> 配置文件后。找到 <code>PubkeyAuthentication</code> 项，删除该项的注释符 <code>#</code> 并确保该项对应的开关为 <code>yes</code>。</p><p>错误的配置和正确的配置如下：</p><div class="language-sh line-numbers-mode" data-ext="sh" data-title="sh"><button class="copy" title="复制代码" data-copied="已复制"></button><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code><span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">#PubkeyAuthentication no  # -&gt; 错误的配置</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><div class="language-sh line-numbers-mode" data-ext="sh" data-title="sh"><button class="copy" title="复制代码" data-copied="已复制"></button><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code><span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">PubkeyAuthentication</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> yes</span><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">  # -&gt; 正确的配置</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>操作完之后重新启动 <code>sshd</code> 服务，再次尝试就可以免密登录了。 重启命令为：</p><div class="language-sh line-numbers-mode" data-ext="sh" data-title="sh"><button class="copy" title="复制代码" data-copied="已复制"></button><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code><span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">$</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> service</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> sshd</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> restart。</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h2 id="参考" tabindex="-1"><a class="header-anchor" href="#参考"><span>参考</span></a></h2>`,34)),i("p",null,[t(a,{to:"/linux/frx4rgfm.html"},{default:n(()=>s[5]||(s[5]=[e("Linux ssh")])),_:1})]),i("p",null,[t(a,{to:"/article/x9ugwl1u.html"},{default:n(()=>s[6]||(s[6]=[e("windows生成RAS密钥")])),_:1})])])}const v=l(p,[["render",c],["__file","wli34ri0.html.vue"]]),g=JSON.parse('{"path":"/article/wli34ri0.html","title":"SSH 免密登录","lang":"zh-CN","frontmatter":{"title":"SSH 免密登录","createTime":"2025/01/14 11:16:44","permalink":"/article/wli34ri0.html","tags":["Linux","ssh"],"watermark":true},"headers":[],"readingTime":{"minutes":3.05,"words":916},"git":{"updatedTime":1755670488000,"contributors":[{"name":"唐道勇","username":"唐道勇","email":"matias@tangdaoyongdeMacBook-Pro.local","commits":1,"avatar":"https://avatars.githubusercontent.com/唐道勇?v=4","url":"https://github.com/唐道勇"}]},"filePathRelative":"linux/ssh免密登录.md","categoryList":[{"id":"e206a5","sort":10040,"name":"linux"}],"bulletin":false}');export{v as comp,g as data};
