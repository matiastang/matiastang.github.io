import{_ as i,c as a,a as n,o as e}from"./app-CS9K37Kg.js";const l={};function t(h,s){return e(),a("div",null,s[0]||(s[0]=[n(`<h1 id="pre-commit" tabindex="-1"><a class="header-anchor" href="#pre-commit"><span>pre-commit</span></a></h1><p><code>git hooks pre-commit</code>接入校验及修复。</p><ul><li>安装<code>pre-commit</code></li></ul><div class="language-sh line-numbers-mode" data-ext="sh" data-title="sh"><button class="copy" title="复制代码" data-copied="已复制"></button><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code><span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">pip3</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> install</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> pre-commit</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><ul><li>配置<code>pre-commit</code>，项目根目录下创建<code>.pre-commit-config.yaml</code>文件</li></ul><div class="language-yaml line-numbers-mode" data-ext="yaml" data-title="yaml"><button class="copy" title="复制代码" data-copied="已复制"></button><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code><span class="line"><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">repos</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">:</span></span>
<span class="line"><span style="--shiki-light:#999999;--shiki-dark:#666666;">  -</span><span style="--shiki-light:#998418;--shiki-dark:#B8A965;"> repo</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">:</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> https://github.com/pycqa/isort</span></span>
<span class="line"><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">    rev</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">:</span><span style="--shiki-light:#2F798A;--shiki-dark:#4C9A91;"> 5.13.2</span></span>
<span class="line"><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">    hooks</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">:</span></span>
<span class="line"><span style="--shiki-light:#999999;--shiki-dark:#666666;">      -</span><span style="--shiki-light:#998418;--shiki-dark:#B8A965;"> id</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">:</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> isort</span></span>
<span class="line"><span style="--shiki-light:#999999;--shiki-dark:#666666;">  -</span><span style="--shiki-light:#998418;--shiki-dark:#B8A965;"> repo</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">:</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> https://github.com/pre-commit/mirrors-autopep8</span></span>
<span class="line"><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">    rev</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">:</span><span style="--shiki-light:#2F798A;--shiki-dark:#4C9A91;"> 2.1.0</span></span>
<span class="line"><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">    hooks</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">:</span></span>
<span class="line"><span style="--shiki-light:#999999;--shiki-dark:#666666;">      -</span><span style="--shiki-light:#998418;--shiki-dark:#B8A965;"> id</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">:</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> autopep8</span></span>
<span class="line"><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">        args</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">:</span><span style="--shiki-light:#999999;--shiki-dark:#666666;"> [</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">--max-line-length=120</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">]</span></span>
<span class="line"><span style="--shiki-light:#999999;--shiki-dark:#666666;">  -</span><span style="--shiki-light:#998418;--shiki-dark:#B8A965;"> repo</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">:</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> https://gitlab.com/pycqa/flake8</span></span>
<span class="line"><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">    rev</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">:</span><span style="--shiki-light:#2F798A;--shiki-dark:#4C9A91;"> 7.0.0</span></span>
<span class="line"><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">    hooks</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">:</span></span>
<span class="line"><span style="--shiki-light:#999999;--shiki-dark:#666666;">      -</span><span style="--shiki-light:#998418;--shiki-dark:#B8A965;"> id</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">:</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> flake8</span></span>
<span class="line"><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">        args</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">:</span></span>
<span class="line"><span style="--shiki-light:#999999;--shiki-dark:#666666;">            -</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> --max-line-length=120</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>要使用 <code>pre-commit</code> 工具配置 <code>autopep8</code>，以在提交代码前自动格式化 Python 代码以符合 PEP 8 规范，您需要按照以下步骤操作：</p><p>最后，如下的.yaml配置才通过<code>pre-commit autoupdate</code>下载成功。开始有两个问题： 第一个就是autopep8的版本，通过运行<code>pre-commit autoupdate</code>的最新版本是2.0.4，只能写成&#39;v2.0.4&#39;才能成功。 第二个问题就是flake8的地址，需要使用<code>https://github.com/PyCQA/flake8</code>，如果使用<code>https://gitlab.com/pycqa/flake8</code>在下载时需要输入密码。</p><div class="language-yaml line-numbers-mode" data-ext="yaml" data-title="yaml"><button class="copy" title="复制代码" data-copied="已复制"></button><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code><span class="line"><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">repos</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">:</span></span>
<span class="line"><span style="--shiki-light:#999999;--shiki-dark:#666666;">  -</span><span style="--shiki-light:#998418;--shiki-dark:#B8A965;"> repo</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">:</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> https://github.com/pycqa/isort</span></span>
<span class="line"><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">    rev</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">:</span><span style="--shiki-light:#2F798A;--shiki-dark:#4C9A91;"> 5.13.2</span></span>
<span class="line"><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">    hooks</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">:</span></span>
<span class="line"><span style="--shiki-light:#999999;--shiki-dark:#666666;">      -</span><span style="--shiki-light:#998418;--shiki-dark:#B8A965;"> id</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">:</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> isort</span></span>
<span class="line"><span style="--shiki-light:#999999;--shiki-dark:#666666;">  -</span><span style="--shiki-light:#998418;--shiki-dark:#B8A965;"> repo</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">:</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> https://github.com/pre-commit/mirrors-autopep8</span></span>
<span class="line"><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">    rev</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">:</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;"> &#39;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">v2.0.4</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&#39;</span></span>
<span class="line"><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">    hooks</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">:</span></span>
<span class="line"><span style="--shiki-light:#999999;--shiki-dark:#666666;">      -</span><span style="--shiki-light:#998418;--shiki-dark:#B8A965;"> id</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">:</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> autopep8</span></span>
<span class="line"><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">        args</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">:</span><span style="--shiki-light:#999999;--shiki-dark:#666666;"> [</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">--max-line-length=120</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">]</span></span>
<span class="line"><span style="--shiki-light:#999999;--shiki-dark:#666666;">  -</span><span style="--shiki-light:#998418;--shiki-dark:#B8A965;"> repo</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">:</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> https://github.com/PyCQA/flake8</span></span>
<span class="line"><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">    rev</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">:</span><span style="--shiki-light:#2F798A;--shiki-dark:#4C9A91;"> 7.0.0</span></span>
<span class="line"><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">    hooks</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">:</span></span>
<span class="line"><span style="--shiki-light:#999999;--shiki-dark:#666666;">      -</span><span style="--shiki-light:#998418;--shiki-dark:#B8A965;"> id</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">:</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> flake8</span></span>
<span class="line"><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">        args</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">:</span></span>
<span class="line"><span style="--shiki-light:#999999;--shiki-dark:#666666;">            -</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> --max-line-length=120</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-sh line-numbers-mode" data-ext="sh" data-title="sh"><button class="copy" title="复制代码" data-copied="已复制"></button><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code><span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">pre-commit</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> autoupdate</span></span>
<span class="line"><span style="--shiki-light:#999999;--shiki-dark:#666666;">[</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">https://github.com/pycqa/isort</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">]</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> already up to date</span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;">!</span></span>
<span class="line"><span style="--shiki-light:#999999;--shiki-dark:#666666;">[</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">https://github.com/pre-commit/mirrors-autopep8</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">]</span><span style="--shiki-light:#59873A;--shiki-dark:#80A665;"> already</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> up</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> to</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> date!</span></span>
<span class="line"><span style="--shiki-light:#999999;--shiki-dark:#666666;">[</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">https://github.com/PyCQA/flake8</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">]</span><span style="--shiki-light:#59873A;--shiki-dark:#80A665;"> already</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> up</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> to</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> date!</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>配置好了之后，提交通过了测试，期间有配置报错，最后发现是注释不能和内容放在同一行。</p><p>.isort.cfg配置:</p><div class="language- line-numbers-mode" data-ext="" data-title=""><button class="copy" title="复制代码" data-copied="已复制"></button><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code><span class="line"><span>[settings]</span></span>
<span class="line"><span>line_length = 120</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><p>flake8配置:</p><div class="language- line-numbers-mode" data-ext="" data-title=""><button class="copy" title="复制代码" data-copied="已复制"></button><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code><span class="line"><span>[flake8]</span></span>
<span class="line"><span># 忽略 E711 错误</span></span>
<span class="line"><span>ignore = E711</span></span>
<span class="line"><span># 设置最大行长度为 120 字符</span></span>
<span class="line"><span>max-line-length = 120</span></span>
<span class="line"><span># 检查所有类型的错误和警告</span></span>
<span class="line"><span>select = E, W, F, C</span></span>
<span class="line"><span># 在忽略列表中添加更多特定错误</span></span>
<span class="line"><span># F841 未使用的变量</span></span>
<span class="line"><span>extend-ignore = F841</span></span>
<span class="line"><span># 排除以下目录或文件</span></span>
<span class="line"><span>exclude = </span></span>
<span class="line"><span>    .venv/</span></span>
<span class="line"><span>    build/</span></span>
<span class="line"><span>    dist/</span></span>
<span class="line"><span>    docs/_build/</span></span>
<span class="line"><span>    *.log</span></span>
<span class="line"><span>    migrations/*.py</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>只简单设置了几个。</p><p><strong>注意</strong>如果编辑器也有相关配置，那么配置需要一样才行，不然编辑后保存的和提交时检查的格式不一样，那就不会通过。</p><div class="language-sh line-numbers-mode" data-ext="sh" data-title="sh"><button class="copy" title="复制代码" data-copied="已复制"></button><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code><span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">$</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> git</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> commit</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> -m</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;"> &#39;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">feat: - 测试pre-commit</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&#39;</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">isort....................................................................Passed</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">autopep8.................................................................Passed</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">flake8...................................................................Passed</span></span>
<span class="line"><span style="--shiki-light:#999999;--shiki-dark:#666666;">[</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">main 1a8c2e3</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">]</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> feat: - 测试pre-commit</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;"> Committer:</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> 唐道勇</span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;"> &lt;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">matias@tangdaoyongdeMacBook-Pro.loca</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">l</span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">Your</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> name</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> and</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> email</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> address</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> were</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> configured</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> automatically</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> based</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">on</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> your</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> username</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> and</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> hostname.</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> Please</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> check</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> that</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> they</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> are</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> accurate.</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">You</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> can</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> suppress</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> this</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> message</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> by</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> setting</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> them</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> explicitly:</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">    git</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> config</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> --global</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> user.name</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;"> &quot;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">Your Name</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">    git</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> config</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> --global</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> user.email</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> you@example.com</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">After</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> doing</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> this,</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> you</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> may</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> fix</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> the</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> identity</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> used</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> for</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> this</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> commit</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> with:</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">    git</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> commit</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> --amend</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> --reset-author</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;"> 4</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> files</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> changed,</span><span style="--shiki-light:#2F798A;--shiki-dark:#4C9A91;"> 16</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> insertions</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">(</span><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">+</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">)</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">,</span><span style="--shiki-light:#2F798A;--shiki-dark:#4C9A91;"> 13</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> deletions</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">(</span><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">-</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">)</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>-------LLM回答------</p><h3 id="步骤-1-安装-pre-commit" tabindex="-1"><a class="header-anchor" href="#步骤-1-安装-pre-commit"><span>步骤 1：安装 pre-commit</span></a></h3><p>确保您已经在本地机器上安装了 <code>pre-commit</code>。如果没有，可以使用 <code>pip</code> 安装：</p><div class="language-bash line-numbers-mode" data-ext="bash" data-title="bash"><button class="copy" title="复制代码" data-copied="已复制"></button><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code><span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">pip</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> install</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> pre-commit</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h3 id="步骤-2-在项目根目录下创建-pre-commit-config-yaml-文件" tabindex="-1"><a class="header-anchor" href="#步骤-2-在项目根目录下创建-pre-commit-config-yaml-文件"><span>步骤 2：在项目根目录下创建 <code>.pre-commit-config.yaml</code> 文件</span></a></h3><p>在您的项目根目录下创建一个名为 <code>.pre-commit-config.yaml</code> 的文件。这个文件用于定义 pre-commit 需要执行的各种钩子（hooks）。添加以下内容以配置 <code>autopep8</code>：</p><div class="language-yaml line-numbers-mode" data-ext="yaml" data-title="yaml"><button class="copy" title="复制代码" data-copied="已复制"></button><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code><span class="line"><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">repos</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">:</span></span>
<span class="line"><span style="--shiki-light:#999999;--shiki-dark:#666666;">  -</span><span style="--shiki-light:#998418;--shiki-dark:#B8A965;"> repo</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">:</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> https://github.com/pre-commit/mirrors-autopep8</span></span>
<span class="line"><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">    rev</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">:</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;"> &#39;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">v&lt;latest_version&gt;</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&#39;</span><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">  # 替换为所需的 autopep8 版本</span></span>
<span class="line"><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">    hooks</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">:</span></span>
<span class="line"><span style="--shiki-light:#999999;--shiki-dark:#666666;">      -</span><span style="--shiki-light:#998418;--shiki-dark:#B8A965;"> id</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">:</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> autopep8</span></span>
<span class="line"><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">        args</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">:</span><span style="--shiki-light:#999999;--shiki-dark:#666666;"> [</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">--in-place</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">,</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> --aggressive</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">,</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> --aggressive</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">]</span><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">  # 可选：自定义 autopep8 参数</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>这里写了版本号后，提示有问题：</p><div class="language-sh line-numbers-mode" data-ext="sh" data-title="sh"><button class="copy" title="复制代码" data-copied="已复制"></button><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code><span class="line"><span style="--shiki-light:#999999;--shiki-dark:#666666;">[</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">INFO</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">]</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> Initializing environment </span><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">for</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> https://github.com/pre-commit/mirrors-autopep8.</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">An</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> unexpected</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> error</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> has</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> occurred:</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> CalledProcessError:</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> command:</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> (</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&#39;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">/Applications/Xcode.app/Contents/Developer/usr/libexec/git-core/git</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&#39;</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">, </span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&#39;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">checkout</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&#39;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">,</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;"> &#39;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">v2.1.0</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&#39;</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">)</span></span>
<span class="line"><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">return</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> code:</span><span style="--shiki-light:#2F798A;--shiki-dark:#4C9A91;"> 1</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">stdout:</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> (none)</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">stderr:</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">    error:</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> pathspec</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;"> &#39;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">v2.1.0</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&#39;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> did</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> not</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> match</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> any</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> file</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">(</span><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">s</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">)</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> known</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> to</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> git</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">Check</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> the</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> log</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> at</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> /Users/matias/.cache/pre-commit/pre-commit.log</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>后面直接写了个空字符。 github上的提示：</p><div class="language-yaml line-numbers-mode" data-ext="yaml" data-title="yaml"><button class="copy" title="复制代码" data-copied="已复制"></button><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code><span class="line"><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">repos</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">:</span></span>
<span class="line"><span style="--shiki-light:#999999;--shiki-dark:#666666;">-</span><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">   repo</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">:</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> https://github.com/hhatto/autopep8</span></span>
<span class="line"><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">    rev</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">:</span><span style="--shiki-light:#2F798A;--shiki-dark:#4C9A91;"> ...</span><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">  # select the tag or revision you want, or run \`pre-commit autoupdate\`</span></span>
<span class="line"><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">    hooks</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">:</span></span>
<span class="line"><span style="--shiki-light:#999999;--shiki-dark:#666666;">    -</span><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">   id</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">:</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> autopep8</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>pre-commit autoupdate 命令用于自动更新 .pre-commit-config.yaml 文件中指定的所有钩子到最新版本。这个命令并不直接提供一个进度条或百分比来显示更新的进度，因为它主要是一个串行过程，逐个更新钩子。</p><p>这里的 <code>rev</code> 字段指定了要使用的 <code>autopep8</code> 版本，您可以替换 <code>&lt;latest_version&gt;</code> 为实际的版本号（例如 <code>v1.6.0</code>）。访问 <a href="https://github.com/hhatto/autopep8/releases" target="_blank" rel="noopener noreferrer">autopep8 GitHub releases 页面</a> 查看并选择合适的版本。</p><p><code>args</code> 字段是可选的，用于指定传递给 <code>autopep8</code> 命令的额外参数。示例中的参数会使 <code>autopep8</code> 以最激进的模式自动修复代码格式问题。您可以根据团队的偏好调整这些参数。</p><h3 id="步骤-3-安装钩子" tabindex="-1"><a class="header-anchor" href="#步骤-3-安装钩子"><span>步骤 3：安装钩子</span></a></h3><p>在项目根目录下运行以下命令，让 pre-commit 安装并启用刚刚配置的 <code>autopep8</code> 钩子：</p><div class="language-zsh line-numbers-mode" data-ext="zsh" data-title="zsh"><button class="copy" title="复制代码" data-copied="已复制"></button><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code><span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">$</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> pre-commit</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> install</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">pre-commit</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> installed</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> at</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> .git/hooks/pre-commit</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="步骤-4-测试-pre-commit-钩子" tabindex="-1"><a class="header-anchor" href="#步骤-4-测试-pre-commit-钩子"><span>步骤 4：测试 pre-commit 钩子</span></a></h3><p>现在，每当您尝试提交代码时，pre-commit 将自动运行配置好的 <code>autopep8</code>，对即将提交的 Python 文件进行格式化。要验证配置是否生效，您可以尝试提交一些含有 PEP 8 违规的代码：</p><div class="language-bash line-numbers-mode" data-ext="bash" data-title="bash"><button class="copy" title="复制代码" data-copied="已复制"></button><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code><span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">git</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> add</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> .</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">git</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> commit</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> -m</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;"> &quot;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">Test pre-commit with autopep8</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><p>如果一切正常，<code>autopep8</code> 应该会自动格式化违规代码，并显示一个消息告知您哪些文件被修改。如果您之前配置了 <code>--in-place</code> 参数，这些改动会直接应用到您的工作目录中。确认无误后，再次执行 <code>git commit</code> 命令完成提交。</p><p>至此，您已经在项目中成功配置了 <code>pre-commit</code> 以使用 <code>autopep8</code> 自动格式化 Python 代码。每次提交前，<code>autopep8</code> 都会确保代码符合 PEP 8 规范，有助于保持代码库的一致性和可读性。</p>`,40)]))}const k=i(l,[["render",t],["__file","index.html.vue"]]),d=JSON.parse('{"path":"/article/6jlv30nh/","title":"pre-commit","lang":"zh-CN","frontmatter":{"title":"pre-commit","createTime":"2025/01/21 15:30:36","permalink":"/article/6jlv30nh/","watermark":true},"headers":[],"readingTime":{"minutes":4.28,"words":1285},"git":{"updatedTime":1755670488000,"contributors":[{"name":"唐道勇","username":"唐道勇","email":"matias@tangdaoyongdeMacBook-Pro.local","commits":1,"avatar":"https://avatars.githubusercontent.com/唐道勇?v=4","url":"https://github.com/唐道勇"}]},"filePathRelative":"notes/python/pre-commit.md","categoryList":[{"id":"4358b5","sort":10000,"name":"notes"},{"id":"0d4964","sort":10032,"name":"python"}],"bulletin":false}');export{k as comp,d as data};
