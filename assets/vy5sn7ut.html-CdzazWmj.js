import{_ as i,c as e,a,o as t}from"./app-CS9K37Kg.js";const n={};function l(h,s){return t(),e("div",null,s[0]||(s[0]=[a(`<p><code>Vite v6+</code> 完全采用 ESM，不能再用 <code>require()</code>，也不能用 <code>CJS</code> 的 <code>vite.config</code> 输出，需要用 <code>export default</code> 导出。</p><h2 id="问题" tabindex="-1"><a class="header-anchor" href="#问题"><span>问题</span></a></h2><h3 id="在使用vite-plugin-inspect分析依赖时-报错" tabindex="-1"><a class="header-anchor" href="#在使用vite-plugin-inspect分析依赖时-报错"><span>在使用<code>vite-plugin-inspect</code>分析依赖时，报错</span></a></h3><p>包都是目前最新的版本。</p><div class="language-sh line-numbers-mode" data-ext="sh" data-title="sh"><button class="copy" title="复制代码" data-copied="已复制"></button><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code><span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">&quot;vite&quot;</span><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">:</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;"> &quot;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">^6.3.5</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">,</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">&quot;vite-plugin-inspect&quot;</span><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">:</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;"> &quot;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">^11.1.0</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">,</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-sh line-numbers-mode" data-ext="sh" data-title="sh"><button class="copy" title="复制代码" data-copied="已复制"></button><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code><span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">$</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> pnpm</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> run</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> dev</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;">&gt;</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> vector-story@0.0.1 dev /Users/matias/matias/KK/memoir/vector-story-web/vector-story</span></span>
<span class="line"><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;">&gt;</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> vite --mode development</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">The</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> CJS</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> build</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> of</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> Vite</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&#39;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">s Node API is deprecated. See https://vite.dev/guide/troubleshooting.html#vite-cjs-node-api-deprecated for more details.</span></span>
<span class="line"><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">failed to load config from /Users/matias/matias/KK/memoir/vector-story-web/vector-story/vite.config.ts</span></span>
<span class="line"><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">error when starting dev server:</span></span>
<span class="line"><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">Error [ERR_REQUIRE_ESM]: require() of ES Module /Users/matias/matias/KK/memoir/vector-story-web/vector-story/node_modules/.pnpm/vite-plugin-inspect@11.1.0_vite@6.3.5_@types+node@22.15.27_less@4.3.0_terser@5.40.0_/node_modules/vite-plugin-inspect/dist/index.mjs not supported.</span></span>
<span class="line"><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">Instead change the require of /Users/matias/matias/KK/memoir/vector-story-web/vector-story/node_modules/.pnpm/vite-plugin-inspect@11.1.0_vite@6.3.5_@types+node@22.15.27_less@4.3.0_terser@5.40.0_/node_modules/vite-plugin-inspect/dist/index.mjs to a dynamic import() which is available in all CommonJS modules.</span></span>
<span class="line"><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">    at Object.&lt;anonymous&gt; (/Users/matias/matias/KK/memoir/vector-story-web/vector-story/vite.config.ts:46:42)</span></span>
<span class="line"><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">    at _require.extensions.&lt;computed&gt; [as .js] (file:///Users/matias/matias/KK/memoir/vector-story-web/vector-story/node_modules/.pnpm/vite@6.3.5_@types+node@22.15.27_less@4.3.0_terser@5.40.0/node_modules/vite/dist/node/chunks/dep-DBxKXgDP.js:49428:16)</span></span>
<span class="line"><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">    at loadConfigFromBundledFile (file:///Users/matias/matias/KK/memoir/vector-story-web/vector-story/node_modules/.pnpm/vite@6.3.5_@types+node@22.15.27_less@4.3.0_terser@5.40.0/node_modules/vite/dist/node/chunks/dep-DBxKXgDP.js:49434:17)</span></span>
<span class="line"><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">    at async bundleAndLoadConfigFile (file:///Users/matias/matias/KK/memoir/vector-story-web/vector-story/node_modules/.pnpm/vite@6.3.5_@types+node@22.15.27_less@4.3.0_terser@5.40.0/node_modules/vite/dist/node/chunks/dep-DBxKXgDP.js:49259:22)</span></span>
<span class="line"><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">    at async loadConfigFromFile (file:///Users/matias/matias/KK/memoir/vector-story-web/vector-story/node_modules/.pnpm/vite@6.3.5_@types+node@22.15.27_less@4.3.0_terser@5.40.0/node_modules/vite/dist/node/chunks/dep-DBxKXgDP.js:49222:44)</span></span>
<span class="line"><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">    at async resolveConfig (file:///Users/matias/matias/KK/memoir/vector-story-web/vector-story/node_modules/.pnpm/vite@6.3.5_@types+node@22.15.27_less@4.3.0_terser@5.40.0/node_modules/vite/dist/node/chunks/dep-DBxKXgDP.js:48718:24)</span></span>
<span class="line"><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> ELIFECYCLE  Command failed with exit code 1.</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>在添加<code>&quot;type&quot;: &quot;module&quot;,</code>到<code>package.json</code>中，然后重新运行项目，分析页面可以进入，但没有多少内容。访问网页提示：</p><div class="language-sh line-numbers-mode" data-ext="sh" data-title="sh"><button class="copy" title="复制代码" data-copied="已复制"></button><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code><span class="line"><span style="--shiki-light:#999999;--shiki-dark:#666666;">[</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">plugin:vite-plugin-eslint</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">]</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> module is not defined in ES module scope</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">This</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> file</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> is</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> being</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> treated</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> as</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> an</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> ES</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> module</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> because</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> it</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> has</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> a</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;"> &#39;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">.js</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&#39;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> file</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> extension</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> and</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;"> &#39;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">/Users/matias/matias/KK/memoir/vector-story-web/vector-story/package.json</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&#39;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> contains</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;"> &quot;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">type</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">:</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;"> &quot;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">module</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">.</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> To</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> treat</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> it</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> as</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> a</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> CommonJS</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> script,</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> rename</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> it</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> to</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> use</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> the</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;"> &#39;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">.cjs</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&#39;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> file</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> extension.</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><p>如果不使用<code>vite-plugin-inspect</code>直接运行项目，访问就是没问题的。</p><p><code>vite-plugin-inspect</code>也是正确导入的。</p><div class="language-ts line-numbers-mode" data-ext="ts" data-title="ts"><button class="copy" title="复制代码" data-copied="已复制"></button><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code><span class="line"><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">import</span><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;"> Inspect</span><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;"> from</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;"> &#39;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">vite-plugin-inspect</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&#39;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>最后发现是项目中的<code>.stylelintrc.js</code>和<code>eslint.config.js</code>中使用了<code>module.exports</code>导出。最后将其改成<code>export default</code>导出，问题解决。</p><h2 id="参考" tabindex="-1"><a class="header-anchor" href="#参考"><span>参考</span></a></h2><p><a href="https://vitejs.cn/" target="_blank" rel="noopener noreferrer">vite 中文网</a></p>`,14)]))}const d=i(n,[["render",l],["__file","vy5sn7ut.html.vue"]]),r=JSON.parse('{"path":"/vue/vy5sn7ut.html","title":"vite","lang":"zh-CN","frontmatter":{"title":"vite","createTime":"2025/06/04 10:44:36","permalink":"/vue/vy5sn7ut.html","watermark":true},"headers":[],"readingTime":{"minutes":1.43,"words":429},"git":{"updatedTime":1755670488000,"contributors":[{"name":"唐道勇","username":"唐道勇","email":"matias@tangdaoyongdeMacBook-Pro.local","commits":1,"avatar":"https://avatars.githubusercontent.com/唐道勇?v=4","url":"https://github.com/唐道勇"}]},"filePathRelative":"notes/vue/vite.md","categoryList":[{"id":"4358b5","sort":10000,"name":"notes"},{"id":"67cf80","sort":10055,"name":"vue"}],"bulletin":false}');export{d as comp,r as data};
