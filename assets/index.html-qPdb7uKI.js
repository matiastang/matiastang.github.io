import{_ as a,c as i,a as e,o as n}from"./app-CS9K37Kg.js";const t={};function l(r,s){return n(),i("div",null,s[0]||(s[0]=[e(`<h1 id="rm命令" tabindex="-1"><a class="header-anchor" href="#rm命令"><span>rm命令</span></a></h1><h2 id="介绍" tabindex="-1"><a class="header-anchor" href="#介绍"><span>介绍</span></a></h2><p>Linux rm（英文全拼：remove）命令用于删除一个文件或者目录。</p><blockquote><p>rm [options] name...</p></blockquote><p>-f, --force 忽略不存在的文件，从不给出提示。即使原档案属性设为唯读，亦直接删除，无需逐一确认。 -i, --interactive 进行交互式删除，删除前逐一询问确认。 -r, -R, --recursive 指示rm将参数中列出的全部目录和子目录均递归地删除。将目录及以下之档案亦逐一删除。 -v, --verbose 详细显示进行的步骤 --help 显示此帮助信息并退出 --version 输出版本信息并退出</p><h3 id="删除文件可以直接使用rm命令" tabindex="-1"><a class="header-anchor" href="#删除文件可以直接使用rm命令"><span>删除文件可以直接使用rm命令</span></a></h3><blockquote><p>rm test.md</p></blockquote><h3 id="删除目录则必须配合选项-r" tabindex="-1"><a class="header-anchor" href="#删除目录则必须配合选项-r"><span>删除目录则必须配合选项&quot;-r&quot;</span></a></h3><blockquote><p>rm -r test</p></blockquote><h3 id="删除当前目录下的所有文件及目录" tabindex="-1"><a class="header-anchor" href="#删除当前目录下的所有文件及目录"><span>删除当前目录下的所有文件及目录</span></a></h3><blockquote><p>rm -r *</p></blockquote><p>rm常见命令参数 rm: 可以备份，尽量不要删除，比删除更好的是重命名 --&gt;只删除文件链接，重启、重新写入后回收</p><p>删除文件时，使用绝对路径或者进入到目标路径下后使用删除命令 –&gt; 禁止使用rm –rf ./XXX文件【少个点就是根目录了】</p><p>-r : 删除文件夹</p><p>-f : 强制删除文件</p><p>rm命令删除文件的原理 文件删除原理: Linux通过文件link的数量控制文件的删除，只有当一个文件不存在任何link的时候且没有程序调用的时候，文件才会被真正删除。</p><p>就rm命令而言，就是减少磁盘引用计数i_link(文件到inode的链接数量)；inode节点指向存储数据的block,删除文件并不是清除inode和block，而是将文件的硬链接为0，引用计数为0 才能删除文件</p><p>注：如果有新的数据存储或者系统通过类似fsck命令做磁盘检查的时候，被删除的数据块和目录会被释放，数据无法找回</p><p>文件删除的条件：</p><p>i_nlink 文件的硬链接数量，磁盘的引用计数器</p><p>i_count 内存引用计数(一个文件被几个程序调用，有一个程序使用i_count + 1 )</p><p>i_link = 0 &amp;&amp; i_count =0</p><p>删除一个文件，也是删除上一级目录的block里面的文件名</p><p>rm相关的问题答疑 问题1：当执行了删除操作后，ls 无法查找到这个文件，但是调用这个删除文件的进程却正常执行，依然能够读取和写入文件内容？</p><p>答案： 因为rm只是减少了i_nlink，如果没有其他的链接了[即i_link=0】，但由于文件依然被进程使用，所以即时执行了rm命令，系统并未真正的删除。</p><p>只有当i_link和i_count==0时候，系统才会整正删除这个文件，也就是删除文件还需要解除进程对该文件的调用才行。</p><p>问题2：当文件没有被调用，但是执行了rm命令，删除后的文件还能找回来么？</p><p>答案：rm只是减少了i_link的数量，实际就是将文件的inode的链接删除了，但是并没有删除文件实体(block数据块)，如果停止机器工作，还是可以找回数据的。如果此时继续有数据写入，当新数据就可能会被分配到被删除的数据的block数据块，此时文件就会被真正的回收。</p><p>问题3：被进程占用的文件能否被删除？</p><p>答案： 能</p><p>问题4：如何找回没有链接指向但被进程占用的文件？</p><p>答案：lsof -c &#39;vim&#39; 根据后台占用文件的命令查找</p><p>1 2 3 4 5 [root@localhost omc]# touch hhh.txt [root@localhost omc]# vim hhh.txt &amp; [root@localhost omc]# rm hhh.txt [root@localhost omc]# lsof -c &#39;vim&#39; | grep hhh.txt vim 3385 root 4u REG 8,2 4096 271298 /home/omc/.hhh.txt.swp</p><p>常用的命令展示： 删除某个文件夹： -r</p><p>1 rm -rf /home/omc/last.txt 自定义回收站功能: 定义一个函数，将文件移动到指定目录；同时别命名rm命令即可</p><p>1 2 3 myrm(){ D=/tmp/$(date +%Y%m%d%H%M%S); mkdir -p <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>D</mi><mo separator="true">;</mo><mi>m</mi><mi>v</mi><mi mathvariant="normal">&quot;</mi></mrow><annotation encoding="application/x-tex">D; mv &quot;</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8889em;vertical-align:-0.1944em;"></span><span class="mord mathnormal" style="margin-right:0.02778em;">D</span><span class="mpunct">;</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal">m</span><span class="mord mathnormal" style="margin-right:0.03588em;">v</span><span class="mord">&quot;</span></span></span></span>@&quot; $D &amp;&amp; echo &quot;moved to $D ok&quot;; } alias rm=&#39;myrm&#39;</p><h1 id="这个程序的所有参数-作为一个i整体传递、" tabindex="-1"><a class="header-anchor" href="#这个程序的所有参数-作为一个i整体传递、"><span>$@: 这个程序的所有参数，作为一个i整体传递、</span></a></h1><h2 id="自定义rm回收站" tabindex="-1"><a class="header-anchor" href="#自定义rm回收站"><span>自定义<code>rm</code>回收站</span></a></h2><p><a href="https://github.com/lagerspetz/linux-stuff" target="_blank" rel="noopener noreferrer">GitHub自定义<code>rm</code>回收站脚本文件</a></p><p><code>linux-stuff/scripts/saferm.sh</code>适用于服务器和桌面两种环境。 如果脚本检测到 <code>GNOME</code> 、<code>KDE</code>、<code>Unity</code> 或 <code>LXDE</code> 桌面环境（<code>DE</code>），则它将文件或文件夹安全地移动到默认垃圾箱 <code>$HOME/.local/share/Trash/files</code>，否则会在您的主目录中创建垃圾箱文件夹 <code>$HOME/Trash</code>。 <code>.sh</code>文件查看<code>mt_saferm.sh</code>文件 <code>MacOS</code>使用处理 修改<code>.sh</code>文件</p><div class="language-sh line-numbers-mode" data-ext="sh" data-title="sh"><button class="copy" title="复制代码" data-copied="已复制"></button><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code><span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;"># trash_desktops=&quot;$HOME/.local/share/Trash/files&quot;</span></span>
<span class="line"><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;">trash_desktops</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">=</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">$HOME/.Trash</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;"># if neither is running:</span></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;"># trash_fallback=&quot;$HOME/Trash&quot;</span></span>
<span class="line"><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;">trash_fallback</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">=</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">$HOME/.Trash</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>修改删除指令 <code>MacOS</code>删除夹的位置在用户目录下：<code>/Users/matias/.Trash/</code>即<code>$HOME/.Trash</code>。</p><div class="language-sh line-numbers-mode" data-ext="sh" data-title="sh"><button class="copy" title="复制代码" data-copied="已复制"></button><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code><span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;"># mv -b -- &quot;$1&quot; &quot;\${trash}&quot; # moves and backs up old files</span></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;"># MacOS</span></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;"># mv: illegal option -- b</span></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;"># usage: mv [-f | -i | -n] [-v] source target</span></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">#        mv [-f | -i | -n] [-v] source ... directory</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">    mv</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> -i</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;"> &quot;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">$1</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;"> &quot;</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">\${</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">trash</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">}</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ol><li>编写<code>.bin</code>文件</li><li>将<code>.sh</code>移动到<code>bin</code>文件夹</li></ol><div class="language- line-numbers-mode" data-ext="" data-title=""><button class="copy" title="复制代码" data-copied="已复制"></button><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code><span class="line"><span>sudo mv mt_saferm.sh /bin</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p><code>MacOS</code>的<code>bin</code>文件夹在<code>/usr/local/bin</code></p><div class="language- line-numbers-mode" data-ext="" data-title=""><button class="copy" title="复制代码" data-copied="已复制"></button><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code><span class="line"><span>sudo mv mt_saferm.sh /usr/local/bin</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><ol start="3"><li>定义别名，可略</li></ol><div class="language- line-numbers-mode" data-ext="" data-title=""><button class="copy" title="复制代码" data-copied="已复制"></button><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code><span class="line"><span>alias rm=saferm.sh</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><ol start="4"><li>执行下面的命令使其生效，</li></ol><div class="language- line-numbers-mode" data-ext="" data-title=""><button class="copy" title="复制代码" data-copied="已复制"></button><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code><span class="line"><span>$ source ~/.bashrc</span></span>
<span class="line"><span>$ source ~/.zshrc</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><p><a href="https://mp.weixin.qq.com/s/2oaX-ZRGkSC_9Cd1IYm1uQ" target="_blank" rel="noopener noreferrer">参考</a></p>`,52)]))}const p=a(t,[["render",l],["__file","index.html.vue"]]),d=JSON.parse('{"path":"/linux/ipdiu2hp/","title":"linux-rm命令","lang":"zh-CN","frontmatter":{"title":"linux-rm命令","createTime":"2025/01/21 15:34:16","permalink":"/linux/ipdiu2hp/","watermark":true},"headers":[],"readingTime":{"minutes":4.47,"words":1342},"git":{"updatedTime":1755670488000,"contributors":[{"name":"唐道勇","username":"唐道勇","email":"matias@tangdaoyongdeMacBook-Pro.local","commits":1,"avatar":"https://avatars.githubusercontent.com/唐道勇?v=4","url":"https://github.com/唐道勇"}]},"filePathRelative":"notes/linux/linux-rm命令.md","bulletin":false}');export{p as comp,d as data};
